import { decodeHex } from "../../../formats/hex";
import { describe, it } from "vitest";
import { verifyAMD } from "./amd_verify";
import { decodeBase64 } from "../../../formats/base64";

describe('amd_verify', () => {
    it('should verify amd signature', async () => {
        const key = decodeBase64('MIIFTDCCAvugAwIBAgIBADBGBgkqhkiG9w0BAQowOaAPMA0GCWCGSAFlAwQCAgUAoRwwGgYJKoZIhvcNAQEIMA0GCWCGSAFlAwQCAgUAogMCATCjAwIBATB7MRQwEgYDVQQLDAtFbmdpbmVlcmluZzELMAkGA1UEBhMCVVMxFDASBgNVBAcMC1NhbnRhIENsYXJhMQswCQYDVQQIDAJDQTEfMB0GA1UECgwWQWR2YW5jZWQgTWljcm8gRGV2aWNlczESMBAGA1UEAwwJU0VWLU1pbGFuMB4XDTIzMDQwMzE5MjM0M1oXDTMwMDQwMzE5MjM0M1owejEUMBIGA1UECwwLRW5naW5lZXJpbmcxCzAJBgNVBAYTAlVTMRQwEgYDVQQHDAtTYW50YSBDbGFyYTELMAkGA1UECAwCQ0ExHzAdBgNVBAoMFkFkdmFuY2VkIE1pY3JvIERldmljZXMxETAPBgNVBAMMCFNFVi1WQ0VLMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAEoXrM2Ase3rDTnzCqXAixTHBwBR0pP86ZoN5V5mKnwnaFeqNAZ82ez1IckEicDUB11W5hzNor5pbvsbnU6dFd0v6jKwJIQJrMkUgXIkAtMaI3POGwRlCYBw9PY8x2IKPpo4IBFjCCARIwEAYJKwYBBAGceAEBBAMCAQAwFwYJKwYBBAGceAECBAoWCE1pbGFuLUIwMBEGCisGAQQBnHgBAwEEAwIBAzARBgorBgEEAZx4AQMCBAMCAQAwEQYKKwYBBAGceAEDBAQDAgEAMBEGCisGAQQBnHgBAwUEAwIBADARBgorBgEEAZx4AQMGBAMCAQAwEQYKKwYBBAGceAEDBwQDAgEAMBEGCisGAQQBnHgBAwMEAwIBCDARBgorBgEEAZx4AQMIBAMCAXMwTQYJKwYBBAGceAEEBEDUlVTscX9OWw/msUO88EBb164wRyft9GYD8qdq72o6vBXXrzjbdXA5Ap8O+s/QjiRDJIhHOMcrCC4vh6RNVB62MEYGCSqGSIb3DQEBCjA5oA8wDQYJYIZIAWUDBAICBQChHDAaBgkqhkiG9w0BAQgwDQYJYIZIAWUDBAICBQCiAwIBMKMDAgEBA4ICAQBOizm6CMC5PdFwNp2R50/f3g1GASo8XauAdQTaCfzCGYIEECIe+Unok4J0pR9pbphmd5KvsEemh1SEf28MwqkqmhnXa9HAUzb+uJ/9xjBITtxFubxg2C7Y5z5b7IdeBpYf6cHJS45wRKDPTOJGfpbSO7EQ6+XkMtUaLlbMrGroJLHlfLaFI9cMi5rDkL1nmiXxg5xJiFPo68mVZLiAR168XOGhTA1uVypU5gNsTHAIp4tmOlMj04dRkK8b2rYD20bNv81TRGIzPWdGt6k5uVXGM7VdnkO9LxlQYAXqF/w11p/TIJ4e4WV0vyLuYRJVdfEiswEGQewwWPSaOPFHQZnrpLS2iLJV1S5C9YkM7H+1fZVYeVRR39D9Bk/rCIRCoqkaFUgZZzyVF2SivT6AqLsvDuqg/UsvwFn0VeqkYhBublC6uXD6Zsogl1qYibxfkyO+SAMKil2WLiHEgX34/vS3SaevwCHgFAuR9DxpGOJafjWd0b4p0r+LaU/QWAWt6J+H3Mwkml41XsL91R7iP8V5TlXRgA8s31BJYUSr3Gqryk75+qi+L2zfqf28Gt4vqTH54ekRXL3Hr7UlUo9NF3iLswkpXbOvLvrwiRQgmoMRNdUXp3lUB6XXYUAGAVNj+Y+Xby9Gle+/F4jVcvBqmh3Ger9gvZzUPkpDeTL+fXarEA==');
        const data = decodeHex('0200000000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000030000000000087301000000000000000000000000000000D447B55D197491BFE15CF298F9DE9986B7A7C4BE2468B4F6E2D53B71D7C645810B0F2CDFCA0040433BE063FC1A8293F0F3F8DAE7B79FECB3D1CD82BD6A93EBFD7A1E5C266C0108DBC9BB94FA926951320940915D0AAFB42464BD88B579EA158D3E1A0DC39B2C60BD95B9C480CD81841F000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000092B3B47D59F0A2A10A74C5678868A80238CF593C01A82F3CFFB878E904C28D5BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0300000000000873000000000000000000000000000000000000000000000000D49554EC717F4E5B0FE6B143BCF0405BD7AE304727EDF46603F2A76AEF6A3ABC15D7AF38DB757039029F0EFACFD08E244324884738C72B082E2F87A44D541EB603000000000008730434010004340100030000000000087300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000061AB4F11AA661997625F233DF42A4AD54440EEB7A96EA63DE170CBC29C37C005CB54054881EC7D2BEE569B02D07F8272000000000000000000000000000000000000000000000000209D7EB9BE919A1D0BAF1D57FE6EBFEABBC53B778C6E977E40B15CA931BB6D44C5AB9E30CFDC7346CB41AC083B90BF490000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000');
        const rawProtected = data.slice(0, 672);
        const rawSignature = data.slice(672, 672 + 512);
        await verifyAMD(rawProtected, rawSignature, key);
    });
});