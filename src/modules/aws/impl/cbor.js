"use strict";
/**
 * CBOR (Concise Binary Object Representation) implementation
 * Ported from JavaScript to TypeScript
 *
 * Original MIT License notice:
 * The MIT License (MIT)
 * Copyright (c) 2014-2016 Patrick Gansterer <paroga@paroga.com>
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.encodeCBOR = encodeCBOR;
exports.decodeCBOR = decodeCBOR;
const POW_2_24 = 5.960464477539063e-8;
const POW_2_32 = 4294967296;
const POW_2_53 = 9007199254740992;
function encodeCBOR(value) {
    let data = new Uint8Array(256);
    let dataView = new DataView(data.buffer, data.byteOffset, data.byteLength);
    let lastLength;
    let offset = 0;
    function prepareWrite(length) {
        let newByteLength = data.byteLength;
        let requiredLength = offset + length;
        while (newByteLength < requiredLength)
            newByteLength <<= 1;
        if (newByteLength !== data.byteLength) {
            const oldDataView = dataView;
            data = new Uint8Array(newByteLength);
            dataView = new DataView(data.buffer, data.byteOffset, data.byteLength);
            const uint32count = (offset + 3) >> 2;
            for (let i = 0; i < uint32count; ++i)
                dataView.setUint32(i << 2, oldDataView.getUint32(i << 2));
        }
        lastLength = length;
        return dataView;
    }
    function commitWrite() {
        offset += lastLength;
    }
    function writeFloat64(value) {
        const dv = prepareWrite(8);
        dv.setFloat64(offset, value);
        commitWrite();
    }
    function writeUint8(value) {
        const dv = prepareWrite(1);
        dv.setUint8(offset, value);
        commitWrite();
    }
    function writeUint8Array(value) {
        const dataView = prepareWrite(value.length);
        for (let i = 0; i < value.length; ++i)
            dataView.setUint8(offset + i, value[i]);
        commitWrite();
    }
    function writeUint16(value) {
        const dv = prepareWrite(2);
        dv.setUint16(offset, value);
        commitWrite();
    }
    function writeUint32(value) {
        const dv = prepareWrite(4);
        dv.setUint32(offset, value);
        commitWrite();
    }
    function writeUint64(value) {
        const low = value % POW_2_32;
        const high = (value - low) / POW_2_32;
        const dataView = prepareWrite(8);
        dataView.setUint32(offset, high);
        dataView.setUint32(offset + 4, low);
        commitWrite();
    }
    function writeTypeAndLength(type, length) {
        if (length < 24) {
            writeUint8(type << 5 | length);
        }
        else if (length < 0x100) {
            writeUint8(type << 5 | 24);
            writeUint8(length);
        }
        else if (length < 0x10000) {
            writeUint8(type << 5 | 25);
            writeUint16(length);
        }
        else if (length < 0x100000000) {
            writeUint8(type << 5 | 26);
            writeUint32(length);
        }
        else {
            writeUint8(type << 5 | 27);
            writeUint64(length);
        }
    }
    function encodeItem(value) {
        let i;
        if (value === false)
            return writeUint8(0xf4);
        if (value === true)
            return writeUint8(0xf5);
        if (value === null)
            return writeUint8(0xf6);
        if (value === undefined)
            return writeUint8(0xf7);
        switch (typeof value) {
            case "number":
                if (Math.floor(value) === value) {
                    if (0 <= value && value <= POW_2_53)
                        return writeTypeAndLength(0, value);
                    if (-POW_2_53 <= value && value < 0)
                        return writeTypeAndLength(1, -(value + 1));
                }
                writeUint8(0xfb);
                return writeFloat64(value);
            case "string": {
                const utf8data = [];
                for (i = 0; i < value.length; ++i) {
                    let charCode = value.charCodeAt(i);
                    if (charCode < 0x80) {
                        utf8data.push(charCode);
                    }
                    else if (charCode < 0x800) {
                        utf8data.push(0xc0 | charCode >> 6);
                        utf8data.push(0x80 | charCode & 0x3f);
                    }
                    else if (charCode < 0xd800) {
                        utf8data.push(0xe0 | charCode >> 12);
                        utf8data.push(0x80 | (charCode >> 6) & 0x3f);
                        utf8data.push(0x80 | charCode & 0x3f);
                    }
                    else {
                        charCode = (charCode & 0x3ff) << 10;
                        charCode |= value.charCodeAt(++i) & 0x3ff;
                        charCode += 0x10000;
                        utf8data.push(0xf0 | charCode >> 18);
                        utf8data.push(0x80 | (charCode >> 12) & 0x3f);
                        utf8data.push(0x80 | (charCode >> 6) & 0x3f);
                        utf8data.push(0x80 | charCode & 0x3f);
                    }
                }
                writeTypeAndLength(3, utf8data.length);
                return writeUint8Array(new Uint8Array(utf8data));
            }
            default: {
                let length;
                if (Array.isArray(value)) {
                    length = value.length;
                    writeTypeAndLength(4, length);
                    for (i = 0; i < length; ++i)
                        encodeItem(value[i]);
                }
                else if (value instanceof Uint8Array) {
                    writeTypeAndLength(2, value.length);
                    writeUint8Array(value);
                }
                else {
                    const keys = Object.keys(value);
                    length = keys.length;
                    writeTypeAndLength(5, length);
                    for (i = 0; i < length; ++i) {
                        const key = keys[i];
                        encodeItem(key);
                        encodeItem(value[key]);
                    }
                }
            }
        }
    }
    encodeItem(value);
    if ("slice" in data)
        return data.slice(0, offset);
    const ret = new Uint8Array(offset);
    const retView = new DataView(ret.buffer, ret.byteOffset, ret.byteLength);
    for (let i = 0; i < offset; ++i)
        retView.setUint8(i, dataView.getUint8(i));
    return ret;
}
function decodeCBOR(data, tagger = (value) => value, simpleValue = () => undefined) {
    const dataView = new DataView(data.buffer, data.byteOffset, data.byteLength);
    let offset = 0;
    function commitRead(length, value) {
        offset += length;
        return value;
    }
    function readArrayBuffer(length) {
        return commitRead(length, data.slice(offset, offset + length));
    }
    function readFloat16() {
        const tempArrayBuffer = new ArrayBuffer(4);
        const tempDataView = new DataView(tempArrayBuffer);
        const value = readUint16();
        const sign = value & 0x8000;
        let exponent = value & 0x7c00;
        const fraction = value & 0x03ff;
        if (exponent === 0x7c00)
            exponent = 0xff << 10;
        else if (exponent !== 0)
            exponent += (127 - 15) << 10;
        else if (fraction !== 0)
            return (sign ? -1 : 1) * fraction * POW_2_24;
        tempDataView.setUint32(0, sign << 16 | exponent << 13 | fraction << 13);
        return tempDataView.getFloat32(0);
    }
    function readFloat32() {
        return commitRead(4, dataView.getFloat32(offset));
    }
    function readFloat64() {
        return commitRead(8, dataView.getFloat64(offset));
    }
    function readUint8() {
        return commitRead(1, dataView.getUint8(offset));
    }
    function readUint16() {
        return commitRead(2, dataView.getUint16(offset));
    }
    function readUint32() {
        return commitRead(4, dataView.getUint32(offset));
    }
    function readUint64() {
        return readUint32() * POW_2_32 + readUint32();
    }
    function readBreak() {
        if (dataView.getUint8(offset) !== 0xff)
            return false;
        offset += 1;
        return true;
    }
    function readLength(additionalInformation) {
        if (additionalInformation < 24)
            return additionalInformation;
        if (additionalInformation === 24)
            return readUint8();
        if (additionalInformation === 25)
            return readUint16();
        if (additionalInformation === 26)
            return readUint32();
        if (additionalInformation === 27)
            return readUint64();
        if (additionalInformation === 31)
            return -1;
        throw new Error("Invalid length encoding");
    }
    function readIndefiniteStringLength(majorType) {
        const initialByte = readUint8();
        if (initialByte === 0xff)
            return -1;
        const length = readLength(initialByte & 0x1f);
        if (length < 0 || (initialByte >> 5) !== majorType)
            throw new Error("Invalid indefinite length element");
        return length;
    }
    function appendUtf16Data(utf16data, length) {
        for (let i = 0; i < length; ++i) {
            let value = readUint8();
            if (value & 0x80) {
                if (value < 0xe0) {
                    value = (value & 0x1f) << 6
                        | (readUint8() & 0x3f);
                    length -= 1;
                }
                else if (value < 0xf0) {
                    value = (value & 0x0f) << 12
                        | (readUint8() & 0x3f) << 6
                        | (readUint8() & 0x3f);
                    length -= 2;
                }
                else {
                    value = (value & 0x0f) << 18
                        | (readUint8() & 0x3f) << 12
                        | (readUint8() & 0x3f) << 6
                        | (readUint8() & 0x3f);
                    length -= 3;
                }
            }
            if (value < 0x10000) {
                utf16data.push(value);
            }
            else {
                value -= 0x10000;
                utf16data.push(0xd800 | (value >> 10));
                utf16data.push(0xdc00 | (value & 0x3ff));
            }
        }
    }
    function decodeItem() {
        const initialByte = readUint8();
        const majorType = initialByte >> 5;
        const additionalInformation = initialByte & 0x1f;
        let i;
        let length;
        if (majorType === 7) {
            switch (additionalInformation) {
                case 25:
                    return readFloat16();
                case 26:
                    return readFloat32();
                case 27:
                    return readFloat64();
            }
        }
        length = readLength(additionalInformation);
        if (length < 0 && (majorType < 2 || 6 < majorType))
            throw new Error("Invalid length");
        switch (majorType) {
            case 0:
                return length;
            case 1:
                return -1 - length;
            case 2:
                if (length < 0) {
                    const elements = [];
                    let fullArrayLength = 0;
                    while ((length = readIndefiniteStringLength(majorType)) >= 0) {
                        fullArrayLength += length;
                        elements.push(readArrayBuffer(length));
                    }
                    const fullArray = new Uint8Array(fullArrayLength);
                    let fullArrayOffset = 0;
                    for (i = 0; i < elements.length; ++i) {
                        fullArray.set(elements[i], fullArrayOffset);
                        fullArrayOffset += elements[i].length;
                    }
                    return fullArray;
                }
                return readArrayBuffer(length);
            case 3:
                const utf16data = [];
                if (length < 0) {
                    while ((length = readIndefiniteStringLength(majorType)) >= 0)
                        appendUtf16Data(utf16data, length);
                }
                else
                    appendUtf16Data(utf16data, length);
                return String.fromCharCode.apply(null, utf16data);
            case 4:
                let retArray;
                if (length < 0) {
                    retArray = [];
                    while (!readBreak())
                        retArray.push(decodeItem());
                }
                else {
                    retArray = new Array(length);
                    for (i = 0; i < length; ++i)
                        retArray[i] = decodeItem();
                }
                return retArray;
            case 5:
                const retObject = {};
                for (i = 0; i < length || length < 0 && !readBreak(); ++i) {
                    const key = decodeItem();
                    retObject[key] = decodeItem();
                }
                return retObject;
            case 6:
                return tagger(decodeItem(), length);
            case 7:
                switch (length) {
                    case 20:
                        return false;
                    case 21:
                        return true;
                    case 22:
                        return null;
                    case 23:
                        return undefined;
                    default:
                        return simpleValue(length);
                }
        }
    }
    const ret = decodeItem();
    if (offset !== data.byteLength)
        throw new Error("Remaining bytes");
    return ret;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Jvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNib3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7O0dBT0c7O0FBU0gsZ0NBNEtDO0FBRUQsZ0NBMk5DO0FBaFpELE1BQU0sUUFBUSxHQUFXLG9CQUFvQixDQUFDO0FBQzlDLE1BQU0sUUFBUSxHQUFXLFVBQVUsQ0FBQztBQUNwQyxNQUFNLFFBQVEsR0FBVyxnQkFBZ0IsQ0FBQztBQUsxQyxTQUFnQixVQUFVLENBQUMsS0FBVTtJQUNqQyxJQUFJLElBQUksR0FBRyxJQUFJLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMvQixJQUFJLFFBQVEsR0FBRyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzNFLElBQUksVUFBa0IsQ0FBQztJQUN2QixJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFFZixTQUFTLFlBQVksQ0FBQyxNQUFjO1FBQ2hDLElBQUksYUFBYSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDcEMsSUFBSSxjQUFjLEdBQUcsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQyxPQUFPLGFBQWEsR0FBRyxjQUFjO1lBQ2pDLGFBQWEsS0FBSyxDQUFDLENBQUM7UUFDeEIsSUFBSSxhQUFhLEtBQUssSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ3BDLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQztZQUM3QixJQUFJLEdBQUcsSUFBSSxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDckMsUUFBUSxHQUFHLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDdkUsTUFBTSxXQUFXLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFD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RCxNQUFNLEdBQUcsR0FBRyxVQUFVLEVBQUUsQ0FBQztJQUN6QixJQUFJLE1BQU0sS0FBSyxJQUFJLENBQUMsVUFBVTtRQUMxQixNQUFNLElBQUksS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDdkMsT0FBTyxHQUFHLENBQUM7QUFDZixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDQk9SIChDb25jaXNlIEJpbmFyeSBPYmplY3QgUmVwcmVzZW50YXRpb24pIGltcGxlbWVudGF0aW9uXG4gKiBQb3J0ZWQgZnJvbSBKYXZhU2NyaXB0IHRvIFR5cGVTY3JpcHRcbiAqIFxuICogT3JpZ2luYWwgTUlUIExpY2Vuc2Ugbm90aWNlOlxuICogVGhlIE1JVCBMaWNlbnNlIChNSVQpXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTQtMjAxNiBQYXRyaWNrIEdhbnN0ZXJlciA8cGFyb2dhQHBhcm9nYS5jb20+XG4gKi9cblxuY29uc3QgUE9XXzJfMjQ6IG51bWJlciA9IDUuOTYwNDY0NDc3NTM5MDYzZS04O1xuY29uc3QgUE9XXzJfMzI6IG51bWJlciA9IDQyOTQ5NjcyOTY7XG5jb25zdCBQT1dfMl81MzogbnVtYmVyID0gOTAwNzE5OTI1NDc0MDk5MjtcblxudHlwZSBUYWdGdW5jdGlvbiA9ICh2YWx1ZTogYW55LCB0YWc6IG51bWJlcikgPT4gYW55O1xudHlwZSBTaW1wbGVWYWx1ZUZ1bmN0aW9uID0gKHZhbHVlOiBudW1iZXIpID0+IGFueTtcblxuZXhwb3J0IGZ1bmN0aW9uIGVuY29kZUNCT1IodmFsdWU6IGFueSk6IFVpbnQ4QXJyYXkge1xuICAgIGxldCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoMjU2KTtcbiAgICBsZXQgZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoZGF0YS5idWZmZXIsIGRhdGEuYnl0ZU9mZnNldCwgZGF0YS5ieXRlTGVuZ3RoKTtcbiAgICBsZXQgbGFzdExlbmd0aDogbnVtYmVyO1xuICAgIGxldCBvZmZzZXQgPSAwO1xuXG4gICAgZnVuY3Rpb24gcHJlcGFyZVdyaXRlKGxlbmd0aDogbnVtYmVyKTogRGF0YVZpZXcge1xuICAgICAgICBsZXQgbmV3Qnl0ZUxlbmd0aCA9IGRhdGEuYnl0ZUxlbmd0aDtcbiAgICAgICAgbGV0IHJlcXVpcmVkTGVuZ3RoID0gb2Zmc2V0ICsgbGVuZ3RoO1xuICAgICAgICB3aGlsZSAobmV3Qnl0ZUxlbmd0aCA8IHJlcXVpcmVkTGVuZ3RoKVxuICAgICAgICAgICAgbmV3Qnl0ZUxlbmd0aCA8PD0gMTtcbiAgICAgICAgaWYgKG5ld0J5dGVMZW5ndGggIT09IGRhdGEuYnl0ZUxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3Qgb2xkRGF0YVZpZXcgPSBkYXRhVmlldztcbiAgICAgICAgICAgIGRhdGEgPSBuZXcgVWludDhBcnJheShuZXdCeXRlTGVuZ3RoKTtcbiAgICAgICAgICAgIGRhdGFWaWV3ID0gbmV3IERhdGFWaWV3KGRhdGEuYnVmZmVyLCBkYXRhLmJ5dGVPZmZzZXQsIGRhdGEuYnl0ZUxlbmd0aCk7XG4gICAgICAgICAgICBjb25zdCB1aW50MzJjb3VudCA9IChvZmZzZXQgKyAzKSA+PiAyO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1aW50MzJjb3VudDsgKytpKVxuICAgICAgICAgICAgICAgIGRhdGFWaWV3LnNldFVpbnQzMihpIDw8IDIsIG9sZERhdGFWaWV3LmdldFVpbnQzMihpIDw8IDIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxhc3RMZW5ndGggPSBsZW5ndGg7XG4gICAgICAgIHJldHVybiBkYXRhVmlldztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjb21taXRXcml0ZSgpOiB2b2lkIHtcbiAgICAgICAgb2Zmc2V0ICs9IGxhc3RMZW5ndGg7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gd3JpdGVGbG9hdDY0KHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgZHYgPSBwcmVwYXJlV3JpdGUoOCk7XG4gICAgICAgIGR2LnNldEZsb2F0NjQob2Zmc2V0LCB2YWx1ZSk7XG4gICAgICAgIGNvbW1pdFdyaXRlKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gd3JpdGVVaW50OCh2YWx1ZTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGR2ID0gcHJlcGFyZVdyaXRlKDEpO1xuICAgICAgICBkdi5zZXRVaW50OChvZmZzZXQsIHZhbHVlKTtcbiAgICAgICAgY29tbWl0V3JpdGUoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB3cml0ZVVpbnQ4QXJyYXkodmFsdWU6IFVpbnQ4QXJyYXkpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgZGF0YVZpZXcgPSBwcmVwYXJlV3JpdGUodmFsdWUubGVuZ3RoKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWx1ZS5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgIGRhdGFWaWV3LnNldFVpbnQ4KG9mZnNldCArIGksIHZhbHVlW2ldKTtcbiAgICAgICAgY29tbWl0V3JpdGUoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB3cml0ZVVpbnQxNih2YWx1ZTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGR2ID0gcHJlcGFyZVdyaXRlKDIpO1xuICAgICAgICBkdi5zZXRVaW50MTYob2Zmc2V0LCB2YWx1ZSk7XG4gICAgICAgIGNvbW1pdFdyaXRlKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gd3JpdGVVaW50MzIodmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBjb25zdCBkdiA9IHByZXBhcmVXcml0ZSg0KTtcbiAgICAgICAgZHYuc2V0VWludDMyKG9mZnNldCwgdmFsdWUpO1xuICAgICAgICBjb21taXRXcml0ZSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHdyaXRlVWludDY0KHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgbG93ID0gdmFsdWUgJSBQT1dfMl8zMjtcbiAgICAgICAgY29uc3QgaGlnaCA9ICh2YWx1ZSAtIGxvdykgLyBQT1dfMl8zMjtcbiAgICAgICAgY29uc3QgZGF0YVZpZXcgPSBwcmVwYXJlV3JpdGUoOCk7XG4gICAgICAgIGRhdGFWaWV3LnNldFVpbnQzMihvZmZzZXQsIGhpZ2gpO1xuICAgICAgICBkYXRhVmlldy5zZXRVaW50MzIob2Zmc2V0ICsgNCwgbG93KTtcbiAgICAgICAgY29tbWl0V3JpdGUoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB3cml0ZVR5cGVBbmRMZW5ndGgodHlwZTogbnVtYmVyLCBsZW5ndGg6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBpZiAobGVuZ3RoIDwgMjQpIHtcbiAgICAgICAgICAgIHdyaXRlVWludDgodHlwZSA8PCA1IHwgbGVuZ3RoKTtcbiAgICAgICAgfSBlbHNlIGlmIChsZW5ndGggPCAweDEwMCkge1xuICAgICAgICAgICAgd3JpdGVVaW50OCh0eXBlIDw8IDUgfCAyNCk7XG4gICAgICAgICAgICB3cml0ZVVpbnQ4KGxlbmd0aCk7XG4gICAgICAgIH0gZWxzZSBpZiAobGVuZ3RoIDwgMHgxMDAwMCkge1xuICAgICAgICAgICAgd3JpdGVVaW50OCh0eXBlIDw8IDUgfCAyNSk7XG4gICAgICAgICAgICB3cml0ZVVpbnQxNihsZW5ndGgpO1xuICAgICAgICB9IGVsc2UgaWYgKGxlbmd0aCA8IDB4MTAwMDAwMDAwKSB7XG4gICAgICAgICAgICB3cml0ZVVpbnQ4KHR5cGUgPDwgNSB8IDI2KTtcbiAgICAgICAgICAgIHdyaXRlVWludDMyKGxlbmd0aCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB3cml0ZVVpbnQ4KHR5cGUgPDwgNSB8IDI3KTtcbiAgICAgICAgICAgIHdyaXRlVWludDY0KGxlbmd0aCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBlbmNvZGVJdGVtKHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICAgICAgbGV0IGk6IG51bWJlcjtcblxuICAgICAgICBpZiAodmFsdWUgPT09IGZhbHNlKVxuICAgICAgICAgICAgcmV0dXJuIHdyaXRlVWludDgoMHhmNCk7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdHJ1ZSlcbiAgICAgICAgICAgIHJldHVybiB3cml0ZVVpbnQ4KDB4ZjUpO1xuICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gd3JpdGVVaW50OCgweGY2KTtcbiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICByZXR1cm4gd3JpdGVVaW50OCgweGY3KTtcblxuICAgICAgICBzd2l0Y2ggKHR5cGVvZiB2YWx1ZSkge1xuICAgICAgICAgICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgICAgICAgICAgIGlmIChNYXRoLmZsb29yKHZhbHVlKSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKDAgPD0gdmFsdWUgJiYgdmFsdWUgPD0gUE9XXzJfNTMpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JpdGVUeXBlQW5kTGVuZ3RoKDAsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKC1QT1dfMl81MyA8PSB2YWx1ZSAmJiB2YWx1ZSA8IDApXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JpdGVUeXBlQW5kTGVuZ3RoKDEsIC0odmFsdWUgKyAxKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHdyaXRlVWludDgoMHhmYik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlRmxvYXQ2NCh2YWx1ZSk7XG5cbiAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdcIjoge1xuICAgICAgICAgICAgICAgIGNvbnN0IHV0ZjhkYXRhOiBudW1iZXJbXSA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB2YWx1ZS5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgY2hhckNvZGUgPSB2YWx1ZS5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hhckNvZGUgPCAweDgwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGY4ZGF0YS5wdXNoKGNoYXJDb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyQ29kZSA8IDB4ODAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGY4ZGF0YS5wdXNoKDB4YzAgfCBjaGFyQ29kZSA+PiA2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhkYXRhLnB1c2goMHg4MCB8IGNoYXJDb2RlICYgMHgzZik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhckNvZGUgPCAweGQ4MDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhkYXRhLnB1c2goMHhlMCB8IGNoYXJDb2RlID4+IDEyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhkYXRhLnB1c2goMHg4MCB8IChjaGFyQ29kZSA+PiA2KSAmIDB4M2YpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXRmOGRhdGEucHVzaCgweDgwIHwgY2hhckNvZGUgJiAweDNmKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJDb2RlID0gKGNoYXJDb2RlICYgMHgzZmYpIDw8IDEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hhckNvZGUgfD0gdmFsdWUuY2hhckNvZGVBdCgrK2kpICYgMHgzZmY7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFyQ29kZSArPSAweDEwMDAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB1dGY4ZGF0YS5wdXNoKDB4ZjAgfCBjaGFyQ29kZSA+PiAxOCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGY4ZGF0YS5wdXNoKDB4ODAgfCAoY2hhckNvZGUgPj4gMTIpICYgMHgzZik7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGY4ZGF0YS5wdXNoKDB4ODAgfCAoY2hhckNvZGUgPj4gNikgJiAweDNmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhkYXRhLnB1c2goMHg4MCB8IGNoYXJDb2RlICYgMHgzZik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB3cml0ZVR5cGVBbmRMZW5ndGgoMywgdXRmOGRhdGEubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gd3JpdGVVaW50OEFycmF5KG5ldyBVaW50OEFycmF5KHV0ZjhkYXRhKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICBsZXQgbGVuZ3RoOiBudW1iZXI7XG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVUeXBlQW5kTGVuZ3RoKDQsIGxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZUl0ZW0odmFsdWVbaV0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlVHlwZUFuZExlbmd0aCgyLCB2YWx1ZS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICB3cml0ZVVpbnQ4QXJyYXkodmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IGtleXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB3cml0ZVR5cGVBbmRMZW5ndGgoNSwgbGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBrZXlzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlSXRlbShrZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlSXRlbSh2YWx1ZVtrZXldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGVuY29kZUl0ZW0odmFsdWUpO1xuXG4gICAgaWYgKFwic2xpY2VcIiBpbiBkYXRhKVxuICAgICAgICByZXR1cm4gZGF0YS5zbGljZSgwLCBvZmZzZXQpO1xuXG4gICAgY29uc3QgcmV0ID0gbmV3IFVpbnQ4QXJyYXkob2Zmc2V0KTtcbiAgICBjb25zdCByZXRWaWV3ID0gbmV3IERhdGFWaWV3KHJldC5idWZmZXIsIHJldC5ieXRlT2Zmc2V0LCByZXQuYnl0ZUxlbmd0aCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvZmZzZXQ7ICsraSlcbiAgICAgICAgcmV0Vmlldy5zZXRVaW50OChpLCBkYXRhVmlldy5nZXRVaW50OChpKSk7XG4gICAgcmV0dXJuIHJldDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlY29kZUNCT1IoXG4gICAgZGF0YTogVWludDhBcnJheSxcbiAgICB0YWdnZXI6IFRhZ0Z1bmN0aW9uID0gKHZhbHVlKSA9PiB2YWx1ZSxcbiAgICBzaW1wbGVWYWx1ZTogU2ltcGxlVmFsdWVGdW5jdGlvbiA9ICgpID0+IHVuZGVmaW5lZFxuKTogYW55IHtcbiAgICBjb25zdCBkYXRhVmlldyA9IG5ldyBEYXRhVmlldyhkYXRhLmJ1ZmZlciwgZGF0YS5ieXRlT2Zmc2V0LCBkYXRhLmJ5dGVMZW5ndGgpO1xuICAgIGxldCBvZmZzZXQgPSAwO1xuXG4gICAgZnVuY3Rpb24gY29tbWl0UmVhZChsZW5ndGg6IG51bWJlciwgdmFsdWU6IGFueSk6IGFueSB7XG4gICAgICAgIG9mZnNldCArPSBsZW5ndGg7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWFkQXJyYXlCdWZmZXIobGVuZ3RoOiBudW1iZXIpOiBVaW50OEFycmF5IHtcbiAgICAgICAgcmV0dXJuIGNvbW1pdFJlYWQobGVuZ3RoLCBkYXRhLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVhZEZsb2F0MTYoKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgdGVtcEFycmF5QnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKDQpO1xuICAgICAgICBjb25zdCB0ZW1wRGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcodGVtcEFycmF5QnVmZmVyKTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSByZWFkVWludDE2KCk7XG5cbiAgICAgICAgY29uc3Qgc2lnbiA9IHZhbHVlICYgMHg4MDAwO1xuICAgICAgICBsZXQgZXhwb25lbnQgPSB2YWx1ZSAmIDB4N2MwMDtcbiAgICAgICAgY29uc3QgZnJhY3Rpb24gPSB2YWx1ZSAmIDB4MDNmZjtcblxuICAgICAgICBpZiAoZXhwb25lbnQgPT09IDB4N2MwMClcbiAgICAgICAgICAgIGV4cG9uZW50ID0gMHhmZiA8PCAxMDtcbiAgICAgICAgZWxzZSBpZiAoZXhwb25lbnQgIT09IDApXG4gICAgICAgICAgICBleHBvbmVudCArPSAoMTI3IC0gMTUpIDw8IDEwO1xuICAgICAgICBlbHNlIGlmIChmcmFjdGlvbiAhPT0gMClcbiAgICAgICAgICAgIHJldHVybiAoc2lnbiA/IC0xIDogMSkgKiBmcmFjdGlvbiAqIFBPV18yXzI0O1xuXG4gICAgICAgIHRlbXBEYXRhVmlldy5zZXRVaW50MzIoMCwgc2lnbiA8PCAxNiB8IGV4cG9uZW50IDw8IDEzIHwgZnJhY3Rpb24gPDwgMTMpO1xuICAgICAgICByZXR1cm4gdGVtcERhdGFWaWV3LmdldEZsb2F0MzIoMCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVhZEZsb2F0MzIoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIGNvbW1pdFJlYWQoNCwgZGF0YVZpZXcuZ2V0RmxvYXQzMihvZmZzZXQpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWFkRmxvYXQ2NCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gY29tbWl0UmVhZCg4LCBkYXRhVmlldy5nZXRGbG9hdDY0KG9mZnNldCkpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlYWRVaW50OCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gY29tbWl0UmVhZCgxLCBkYXRhVmlldy5nZXRVaW50OChvZmZzZXQpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWFkVWludDE2KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBjb21taXRSZWFkKDIsIGRhdGFWaWV3LmdldFVpbnQxNihvZmZzZXQpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWFkVWludDMyKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBjb21taXRSZWFkKDQsIGRhdGFWaWV3LmdldFVpbnQzMihvZmZzZXQpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWFkVWludDY0KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiByZWFkVWludDMyKCkgKiBQT1dfMl8zMiArIHJlYWRVaW50MzIoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWFkQnJlYWsoKTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChkYXRhVmlldy5nZXRVaW50OChvZmZzZXQpICE9PSAweGZmKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBvZmZzZXQgKz0gMTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVhZExlbmd0aChhZGRpdGlvbmFsSW5mb3JtYXRpb246IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIGlmIChhZGRpdGlvbmFsSW5mb3JtYXRpb24gPCAyNClcbiAgICAgICAgICAgIHJldHVybiBhZGRpdGlvbmFsSW5mb3JtYXRpb247XG4gICAgICAgIGlmIChhZGRpdGlvbmFsSW5mb3JtYXRpb24gPT09IDI0KVxuICAgICAgICAgICAgcmV0dXJuIHJlYWRVaW50OCgpO1xuICAgICAgICBpZiAoYWRkaXRpb25hbEluZm9ybWF0aW9uID09PSAyNSlcbiAgICAgICAgICAgIHJldHVybiByZWFkVWludDE2KCk7XG4gICAgICAgIGlmIChhZGRpdGlvbmFsSW5mb3JtYXRpb24gPT09IDI2KVxuICAgICAgICAgICAgcmV0dXJuIHJlYWRVaW50MzIoKTtcbiAgICAgICAgaWYgKGFkZGl0aW9uYWxJbmZvcm1hdGlvbiA9PT0gMjcpXG4gICAgICAgICAgICByZXR1cm4gcmVhZFVpbnQ2NCgpO1xuICAgICAgICBpZiAoYWRkaXRpb25hbEluZm9ybWF0aW9uID09PSAzMSlcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBsZW5ndGggZW5jb2RpbmdcIik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVhZEluZGVmaW5pdGVTdHJpbmdMZW5ndGgobWFqb3JUeXBlOiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICBjb25zdCBpbml0aWFsQnl0ZSA9IHJlYWRVaW50OCgpO1xuICAgICAgICBpZiAoaW5pdGlhbEJ5dGUgPT09IDB4ZmYpXG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIGNvbnN0IGxlbmd0aCA9IHJlYWRMZW5ndGgoaW5pdGlhbEJ5dGUgJiAweDFmKTtcbiAgICAgICAgaWYgKGxlbmd0aCA8IDAgfHwgKGluaXRpYWxCeXRlID4+IDUpICE9PSBtYWpvclR5cGUpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGluZGVmaW5pdGUgbGVuZ3RoIGVsZW1lbnRcIik7XG4gICAgICAgIHJldHVybiBsZW5ndGg7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYXBwZW5kVXRmMTZEYXRhKHV0ZjE2ZGF0YTogbnVtYmVyW10sIGxlbmd0aDogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IHJlYWRVaW50OCgpO1xuICAgICAgICAgICAgaWYgKHZhbHVlICYgMHg4MCkge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDB4ZTApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAodmFsdWUgJiAweDFmKSA8PCA2XG4gICAgICAgICAgICAgICAgICAgICAgICB8IChyZWFkVWludDgoKSAmIDB4M2YpO1xuICAgICAgICAgICAgICAgICAgICBsZW5ndGggLT0gMTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIDwgMHhmMCkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZSAmIDB4MGYpIDw8IDEyXG4gICAgICAgICAgICAgICAgICAgICAgICB8IChyZWFkVWludDgoKSAmIDB4M2YpIDw8IDZcbiAgICAgICAgICAgICAgICAgICAgICAgIHwgKHJlYWRVaW50OCgpICYgMHgzZik7XG4gICAgICAgICAgICAgICAgICAgIGxlbmd0aCAtPSAyO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gKHZhbHVlICYgMHgwZikgPDwgMThcbiAgICAgICAgICAgICAgICAgICAgICAgIHwgKHJlYWRVaW50OCgpICYgMHgzZikgPDwgMTJcbiAgICAgICAgICAgICAgICAgICAgICAgIHwgKHJlYWRVaW50OCgpICYgMHgzZikgPDwgNlxuICAgICAgICAgICAgICAgICAgICAgICAgfCAocmVhZFVpbnQ4KCkgJiAweDNmKTtcbiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoIC09IDM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodmFsdWUgPCAweDEwMDAwKSB7XG4gICAgICAgICAgICAgICAgdXRmMTZkYXRhLnB1c2godmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSAtPSAweDEwMDAwO1xuICAgICAgICAgICAgICAgIHV0ZjE2ZGF0YS5wdXNoKDB4ZDgwMCB8ICh2YWx1ZSA+PiAxMCkpO1xuICAgICAgICAgICAgICAgIHV0ZjE2ZGF0YS5wdXNoKDB4ZGMwMCB8ICh2YWx1ZSAmIDB4M2ZmKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkZWNvZGVJdGVtKCk6IGFueSB7XG4gICAgICAgIGNvbnN0IGluaXRpYWxCeXRlID0gcmVhZFVpbnQ4KCk7XG4gICAgICAgIGNvbnN0IG1ham9yVHlwZSA9IGluaXRpYWxCeXRlID4+IDU7XG4gICAgICAgIGNvbnN0IGFkZGl0aW9uYWxJbmZvcm1hdGlvbiA9IGluaXRpYWxCeXRlICYgMHgxZjtcbiAgICAgICAgbGV0IGk6IG51bWJlcjtcbiAgICAgICAgbGV0IGxlbmd0aDogbnVtYmVyO1xuXG4gICAgICAgIGlmIChtYWpvclR5cGUgPT09IDcpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoYWRkaXRpb25hbEluZm9ybWF0aW9uKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAyNTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlYWRGbG9hdDE2KCk7XG4gICAgICAgICAgICAgICAgY2FzZSAyNjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlYWRGbG9hdDMyKCk7XG4gICAgICAgICAgICAgICAgY2FzZSAyNzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlYWRGbG9hdDY0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBsZW5ndGggPSByZWFkTGVuZ3RoKGFkZGl0aW9uYWxJbmZvcm1hdGlvbik7XG4gICAgICAgIGlmIChsZW5ndGggPCAwICYmIChtYWpvclR5cGUgPCAyIHx8IDYgPCBtYWpvclR5cGUpKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBsZW5ndGhcIik7XG5cbiAgICAgICAgc3dpdGNoIChtYWpvclR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGVuZ3RoO1xuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgIHJldHVybiAtMSAtIGxlbmd0aDtcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICBpZiAobGVuZ3RoIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50czogVWludDhBcnJheVtdID0gW107XG4gICAgICAgICAgICAgICAgICAgIGxldCBmdWxsQXJyYXlMZW5ndGggPSAwO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoKGxlbmd0aCA9IHJlYWRJbmRlZmluaXRlU3RyaW5nTGVuZ3RoKG1ham9yVHlwZSkpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxBcnJheUxlbmd0aCArPSBsZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKHJlYWRBcnJheUJ1ZmZlcihsZW5ndGgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmdWxsQXJyYXkgPSBuZXcgVWludDhBcnJheShmdWxsQXJyYXlMZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgZnVsbEFycmF5T2Zmc2V0ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmdWxsQXJyYXkuc2V0KGVsZW1lbnRzW2ldLCBmdWxsQXJyYXlPZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZnVsbEFycmF5T2Zmc2V0ICs9IGVsZW1lbnRzW2ldLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVsbEFycmF5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVhZEFycmF5QnVmZmVyKGxlbmd0aCk7XG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgY29uc3QgdXRmMTZkYXRhOiBudW1iZXJbXSA9IFtdO1xuICAgICAgICAgICAgICAgIGlmIChsZW5ndGggPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICgobGVuZ3RoID0gcmVhZEluZGVmaW5pdGVTdHJpbmdMZW5ndGgobWFqb3JUeXBlKSkgPj0gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZFV0ZjE2RGF0YSh1dGYxNmRhdGEsIGxlbmd0aCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGFwcGVuZFV0ZjE2RGF0YSh1dGYxNmRhdGEsIGxlbmd0aCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgdXRmMTZkYXRhKTtcbiAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICBsZXQgcmV0QXJyYXk6IGFueVtdO1xuICAgICAgICAgICAgICAgIGlmIChsZW5ndGggPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldEFycmF5ID0gW107XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICghcmVhZEJyZWFrKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXRBcnJheS5wdXNoKGRlY29kZUl0ZW0oKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0QXJyYXkgPSBuZXcgQXJyYXkobGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0QXJyYXlbaV0gPSBkZWNvZGVJdGVtKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXRBcnJheTtcbiAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICBjb25zdCByZXRPYmplY3Q6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoIHx8IGxlbmd0aCA8IDAgJiYgIXJlYWRCcmVhaygpOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gZGVjb2RlSXRlbSgpO1xuICAgICAgICAgICAgICAgICAgICByZXRPYmplY3Rba2V5XSA9IGRlY29kZUl0ZW0oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldE9iamVjdDtcbiAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFnZ2VyKGRlY29kZUl0ZW0oKSwgbGVuZ3RoKTtcbiAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDIwOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2ltcGxlVmFsdWUobGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCByZXQgPSBkZWNvZGVJdGVtKCk7XG4gICAgaWYgKG9mZnNldCAhPT0gZGF0YS5ieXRlTGVuZ3RoKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSZW1haW5pbmcgYnl0ZXNcIik7XG4gICAgcmV0dXJuIHJldDtcbn1cbiJdfQ==